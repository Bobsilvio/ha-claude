# Home Assistant Configuration Example

Esempio di configurazione completa per Home Assistant.

## Configuration.yaml

```yaml
# Configurazione di base
homeassistant:
  name: Casa Intelligente
  latitude: 43.7695
  longitude: 11.2560
  elevation: 0
  unit_system: metric
  time_zone: Europe/Rome

# HTTP
http:
  cors_allowed_origins:
    - http://localhost:5000
    - http://localhost:8123

# Logging
logger:
  default: info
  logs:
    custom_components.claude: debug

# Component Claude
claude:
  api_endpoint: http://localhost:5000
  model: claude-3-haiku
  polling_interval: 60
  timeout: 30
  max_retries: 3
```

## Sensor Configuration

```yaml
# Template Sensor
template:
  - sensor:
      - name: Claude Status
        unique_id: claude_status
        state: >
          {% if states('switch.claude_connection') == 'on' %}
            connected
          {% else %}
            disconnected
          {% endif %}
        icon: mdi:cloud-check

      - name: Claude Health
        unique_id: claude_health
        state: >
          {% set status = states('sensor.claude_status') %}
          {% if status == 'connected' %}
            Healthy - {{ states('sensor.claude_entities_count') }} entities
          {% else %}
            Disconnected
          {% endif %}
```

## Automazione di Base

```yaml
automation: !include automations.yaml
script: !include scripts.yaml
```

## Automazioni.yaml

```yaml
# Attiva Claude all'avvio di HA
- id: "claude_startup"
  alias: "Claude - Startup"
  trigger:
    platform: homeassistant
    event: start
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.claude_connection

# Monitora stato di connessione
- id: "claude_connection_monitor"
  alias: "Claude - Monitor Connessione"
  trigger:
    platform: state
    entity_id: switch.claude_connection
  action:
    - service: notify.mobile_app
      data:
        title: "Claude"
        message: "{{ trigger.to_state.state }}</dev>"

# Sincronizzazione oraria
- id: "claude_sync_entities"
  alias: "Claude - Sincronizza Entità"
  trigger:
    platform: time_pattern
    minutes: 5
  action:
    - service: homeassistant.reload_custom_components
```

## Scripts.yaml

```yaml
# Script per eseguire comando via Claude
send_claude_command:
  description: "Invia comando a Claude"
  fields:
    message:
      description: "Messaggio per Claude"
      example: "Accendi le luci"
  sequence:
    - service: claude.send_message
      data:
        message: "{{ message }}"
        context: "Home Assistant script execution"

# Script per scene
activate_evening:
  description: "Attiva scena serale"
  sequence:
    - service: claude.call_service
      data:
        service: "light.turn_on"
        data: '{"entity_id": "group.all_lights", "brightness": 150}'
    - service: climate.set_temperature
      data:
        entity_id: climate.home
        temperature: 20
```

## Groups

```yaml
# Gruppare entità
group:
  living_room:
    name: Soggiorno
    entities:
      - light.living_room
      - climate.living_room
      - switch.fan_living_room

  night_security:
    name: Sicurezza Notte
    entities:
      - lock.front_door
      - binary_sensor.window_living_room
      - binary_sensor.door_front
```

## Input Helpers

```yaml
input_boolean:
  vacation_mode:
    name: Modalità Vacanza
    icon: mdi:beach
  
  guest_mode:
    name: Modalità Ospiti
    icon: mdi:account-multiple

input_number:
  target_temperature:
    name: Temperatura Desiderata
    min: 16
    max: 30
    step: 0.5
    unit_of_measurement: "°C"
    icon: mdi:thermometer

input_select:
  claude_model:
    name: Modello Claude
    options:
      - claude-3-haiku
      - claude-3-sonnet
      - claude-3-opus
```

## Sensors

```yaml
sensor:
  - platform: template
    sensors:
      claude_entities_count:
        friendly_name: "Claude - Entità"
        value_template: >
          {{ states('sensor.claude_entities_count') }}
        icon: mdi:database

      claude_automations:
        friendly_name: "Claude - Automazioni"
        value_template: >
          {{ states('sensor.claude_automations_count') }}
        icon: mdi:robot

      claude_scripts:
        friendly_name: "Claude - Script"
        value_template: >
          {{ states('sensor.claude_scripts_count') }}
        icon: mdi:script
```

## Cards per UI (Lovelace)

```yaml
# dashboard_claude.yaml
views:
  - title: Claude Control
    cards:
      - type: entities
        title: Connessione Claude
        entities:
          - switch.claude_connection
          - sensor.claude_status
          - sensor.claude_entities_count

      - type: gauge
        entity: sensor.claude_entities_count
        min: 0
        max: 100
        title: Entità Disponibili

      - type: history-graph
        entities:
          - sensor.claude_status

      - type: button
        name: "Sincronizza"
        tap_action:
          action: call-service
          service: homeassistant.reload_custom_components
```

## Secrets.yaml

```yaml
# Salva token sensibili
latitude: 43.7695
longitude: 11.2560
api_token: !secret claude_api_token
ha_token: !secret ha_token
```

## Device Automation

```yaml
# Automazioni da dispositivi fisici
device_id: "device_123"
platform: device
type: turned_on
subtype: button_1
action:
  - service: claude.send_message
    data:
      message: "Bottone premuto"
```

## Integration Services

```yaml
# Integrare con altri servizi
service: notify.mobile_app_iphone
data:
  title: Claude
  message: "Operazione completata"
  data:
    url: /lovelace/claude

# Integrare con Telegram
service: notify.telegram
data:
  message: "Status: {{ states('sensor.claude_status') }}"
```

## Debug e Monitoring

```yaml
# Logger avanzato
logger:
  default: warning
  logs:
    custom_components.claude: debug
    aiohttp: debug
    homeassistant.components.http: debug

# Monitor performance
history_stats:
  claude_uptime:
    entity_id: switch.claude_connection
    name: Claude Uptime
    state: "on"
    type: time
    period:
      days: 7
```

## Notes Importanti

1. **Token di sicurezza**: Usa `secrets.yaml` per token
2. **CORS**: Configura CORS per il backend Flask
3. **Timeout**: Adatta i timeout alle tue esigenze
4. **Polling**: 60 secondi è il default, riduci se necessario
5. **Logging**: Attiva debug solo temporaneamente (performance)

## Prossimi step

1. Copia questa config in `configuration.yaml`
2. Riavvia Home Assistant
3. Verifica che Claude appaia in Settings → Integrations
4. Testa i servizi da Developer → Services
5. Crea automazioni personalizzate
